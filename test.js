var array = [
    [
    {
      labs: {
        labName: 'LAB D01 33873',
        labDays: 'M',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB H02 41193',
        labDays: 'T',
        labTime: '17:00 - 19:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB D06 32214',
        labDays: 'H',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      lectures: {
        lectureName: 'LECTURE A1 32231',
        lectureDays: 'MWF',
        lectureTime: '09:00 - 09:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB D04 35043',
        labDays: 'W',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      lectures: {
        lectureName: 'LECTURE A2 32213',
        lectureDays: 'MWF',
        lectureTime: '11:00 - 11:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB D08 36109',
        labDays: 'F',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB H01 41192',
        labDays: 'M',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB D07 33365',
        labDays: 'H',
        labTime: '17:00 - 19:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB H04 44488',
        labDays: 'H',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB D05 34054',
        labDays: 'H',
        labTime: '08:00 - 10:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB H03 41195',
        labDays: 'W',
        labTime: '17:00 - 19:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB D02 38486',
        labDays: 'T',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      labs: {
        labName: 'LAB D03 34038',
        labDays: 'T',
        labTime: '17:00 - 19:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      lectures: {
        lectureName: 'LECTURE B1 41191',
        lectureDays: 'MWF',
        lectureTime: '13:00 - 13:50'
      },
      courseName: 'CMPUT-201',
      courseTerm: 'Winter Term 2023',
      __v: 0
    }
  ],
  [
    {
      labs: {
        labName: 'LAB H01 48986',
        labDays: 'F',
        labTime: '14:00 - 16:50'
      },
      courseName: 'CMPUT-200',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      lectures: {
        lectureName: 'LECTURE B1 48985',
        lectureDays: 'TH',
        lectureTime: '11:00 - 12:20'
      },
      courseName: 'CMPUT-200',
      courseTerm: 'Winter Term 2023',
      __v: 0
    }
  ],
  [
    {
      lectures: {
        lectureName: 'LECTURE B2 41246',
        lectureDays: 'MWF',
        lectureTime: '11:00 - 11:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      seminars: {
        seminarName: 'SEMINAR J3 46447',
        seminarDays: 'T',
        seminarTime: '17:00 - 17:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      seminars: {
        seminarName: 'SEMINAR J2 44491',
        seminarDays: 'T',
        seminarTime: '08:00 - 08:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      lectures: {
        lectureName: 'LECTURE A1 32215',
        lectureDays: 'MWF',
        lectureTime: '10:00 - 10:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      seminars: {
        seminarName: 'SEMINAR F2 32217',
        seminarDays: 'T',
        seminarTime: '12:30 - 13:20'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      seminars: {
        seminarName: 'SEMINAR J1 44490',
        seminarDays: 'M',
        seminarTime: '16:00 - 16:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Winter Term 2023',
      __v: 0
    },
    {
      seminars: {
        seminarName: 'SEMINAR F3 32218',
        seminarDays: 'W',
        seminarTime: '11:00 - 11:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      seminars: {
        seminarName: 'SEMINAR F1 32216',
        seminarDays: 'M',
        seminarTime: '17:00 - 17:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Fall Term 2022',
      __v: 0
    },
    {
      lectures: {
        lectureName: 'LECTURE B1 44489',
        lectureDays: 'MWF',
        lectureTime: '10:00 - 10:50'
      },
      courseName: 'CMPUT-204',
      courseTerm: 'Winter Term 2023',
      __v: 0
    }
  ]
]
// for (let i = 0; i < array.length; ++i) {
//     for (let j = 0; j < array[i].length; ++j) {
//         var object = array[i][j]
//         if (object.lectures != undefined) {
//             var time = object.lectures.lectureTime;
//         };
//         if (object.labs != undefined) {
//             var time = object.labs.labTime;
//         };
//         if (object.seminars != undefined) {
//             var time = object.seminars.seminarTime;
//         };
//         console.log(object.courseFullName + " " + object.courseTerm + " " + time);
//     };
// };
var newVar = [
  {
    "total_usage": 2224.013,
    "total_cost": 13386.29,
    "service_type": "natural_gas",
    "bill_cycle": 201911,
    "growth": 6.089962192661292
  },
  {
    "total_usage": 2507.058,
    "total_cost": 14201.51,
    "service_type": "natural_gas",
    "bill_cycle": 201912,
    "growth": 29.316178350048677
  },
  {
    "total_usage": 2923.399,
    "total_cost": 18364.85,
    "service_type": "natural_gas",
    "bill_cycle": 202001,
    "growth": -31.1674748228273
  },
  {
    "total_usage": 2362.797,
    "total_cost": 12640.99,
    "service_type": "natural_gas",
    "bill_cycle": 202002,
    "growth": 26.76174888201004
  },
  {
    "total_usage": 2506.42,
    "total_cost": 16023.94,
    "service_type": "natural_gas",
    "bill_cycle": 202003,
    "growth": -44.97969912518395
  },
  {
    "total_usage": 1485.257,
    "total_cost": 8816.42,
    "service_type": "natural_gas",
    "bill_cycle": 202004,
    "growth": 24.829919627240997
  },
  {
    "total_usage": 669.369,
    "total_cost": 11005.53,
    "service_type": "natural_gas",
    "bill_cycle": 202005,
    "growth": -51.79505212379595
  },
  {
    "total_usage": 427.294,
    "total_cost": 5305.21,
    "service_type": "natural_gas",
    "bill_cycle": 202006,
    "growth": -15.726427417576302
  },
  {
    "total_usage": 313.579,
    "total_cost": 4470.89,
    "service_type": "natural_gas",
    "bill_cycle": 202007,
    "growth": -3.167378307227433
  },
  {
    "total_usage": 325.895,
    "total_cost": 4329.28,
    "service_type": "natural_gas",
    "bill_cycle": 202008,
    "growth": 18.738912706038885
  },
  {
    "total_usage": 475.637,
    "total_cost": 5140.54,
    "service_type": "natural_gas",
    "bill_cycle": 202009,
    "growth": 94.34008878444675
  },
  {
    "total_usage": 1535.116,
    "total_cost": 9990.13,
    "service_type": "natural_gas",
    "bill_cycle": 202010,
    "growth": 57.46912202343716
  },
  {
    "total_usage": 2261.77,
    "total_cost": 15731.37,
    "service_type": "natural_gas",
    "bill_cycle": 202011,
    "growth": 9.321438628676317
  },
  {
    "total_usage": 2348.742,
    "total_cost": 17197.76,
    "service_type": "natural_gas",
    "bill_cycle": 202012,
    "growth": 6.782627504977409
  },
  {
    "total_usage": 2603.384,
    "total_cost": 18364.22,
    "service_type": "natural_gas",
    "bill_cycle": 202101,
    "growth": 13.498967013028592
  },
  {
    "total_usage": 2987.453,
    "total_cost": 20843.2,
    "service_type": "natural_gas",
    "bill_cycle": 202102,
    "growth": -29.7462961541414
  },
  {
    "total_usage": 1767.432,
    "total_cost": 14643.12,
    "service_type": "natural_gas",
    "bill_cycle": 202103,
    "growth": -23.55003578472348
  },
  {
    "total_usage": 1179.409,
    "total_cost": 11194.66,
    "service_type": "natural_gas",
    "bill_cycle": 202104,
    "growth": -31.687429542299633
  },
  {
    "total_usage": 752.946,
    "total_cost": 7647.36,
    "service_type": "natural_gas",
    "bill_cycle": 202105,
    "growth": -35.31074776131893
  },
  {
    "total_usage": 371.513,
    "total_cost": 4947.02,
    "service_type": "natural_gas",
    "bill_cycle": 202106,
    "growth": -11.063225942082306
  },
  {
    "total_usage": 308.296,
    "total_cost": 4399.72,
    "service_type": "natural_gas",
    "bill_cycle": 202107,
    "growth": 11.295718818470256
  },
  {
    "total_usage": 371.369,
    "total_cost": 4896.7,
    "service_type": "natural_gas",
    "bill_cycle": 202108,
    "growth": 31.93273020605715
  },
  {
    "total_usage": 672.321,
    "total_cost": 6460.35,
    "service_type": "natural_gas",
    "bill_cycle": 202109,
    "growth": 48.95957649353361
  },
  {
    "total_usage": 1322.19,
    "total_cost": 9623.31,
    "service_type": "natural_gas",
    "bill_cycle": 202110,
    "growth": 56.54727947036936
  },
  {
    "total_usage": 1952.526,
    "total_cost": 15065.03,
    "service_type": "natural_gas",
    "bill_cycle": 202111,
    "growth": 94.34319082006473
  },
  {
    "total_usage": 3372.104,
    "total_cost": 29277.86,
    "service_type": "natural_gas",
    "bill_cycle": 202112,
    "growth": -34.066321787179795
  },
  {
    "total_usage": 2872.754,
    "total_cost": 19303.97,
    "service_type": "natural_gas",
    "bill_cycle": 202201,
    "growth": -13.619426470306367
  },
  {
    "total_usage": 2298.191,
    "total_cost": 16674.88,
    "service_type": "natural_gas",
    "bill_cycle": 202202,
    "growth": 19.51246425761385
  },
  {
    "total_usage": 1882.341,
    "total_cost": 19928.56,
    "service_type": "natural_gas",
    "bill_cycle": 202203,
    "growth": null
  },
  {
    "total_usage": 171570.33,
    "total_cost": 26933.79,
    "service_type": "electric",
    "bill_cycle": 201911,
    "growth": 4.331028050638245
  },
  {
    "total_usage": 182900.39,
    "total_cost": 28100.3,
    "service_type": "electric",
    "bill_cycle": 201912,
    "growth": 7.742408444037963
  },
  {
    "total_usage": 191134.11,
    "total_cost": 30275.94,
    "service_type": "electric",
    "bill_cycle": 202001,
    "growth": -13.378379003261337
  },
  {
    "total_usage": 165169.69,
    "total_cost": 26225.51,
    "service_type": "electric",
    "bill_cycle": 202002,
    "growth": -2.110883639631794
  },
  {
    "total_usage": 170056.39,
    "total_cost": 25671.92,
    "service_type": "electric",
    "bill_cycle": 202003,
    "growth": 2.5587490144874283
  },
  {
    "total_usage": 164488.2,
    "total_cost": 26328.8,
    "service_type": "electric",
    "bill_cycle": 202004,
    "growth": 2.447358026191853
  },
  {
    "total_usage": 175748.08,
    "total_cost": 26973.16,
    "service_type": "electric",
    "bill_cycle": 202005,
    "growth": 1.898665191620118
  },
  {
    "total_usage": 182089.53,
    "total_cost": 27485.29,
    "service_type": "electric",
    "bill_cycle": 202006,
    "growth": 12.477547080638399
  },
  {
    "total_usage": 202291.82,
    "total_cost": 30914.78,
    "service_type": "electric",
    "bill_cycle": 202007,
    "growth": 1.946932826305086
  },
  {
    "total_usage": 203973.33,
    "total_cost": 31516.67,
    "service_type": "electric",
    "bill_cycle": 202008,
    "growth": -11.244303411496197
  },
  {
    "total_usage": 171603.9,
    "total_cost": 27972.84,
    "service_type": "electric",
    "bill_cycle": 202009,
    "growth": 1.7744354881377815
  },
  {
    "total_usage": 173780.62,
    "total_cost": 28469.2,
    "service_type": "electric",
    "bill_cycle": 202010,
    "growth": -7.015581751506899
  },
  {
    "total_usage": 167253.51,
    "total_cost": 26471.92,
    "service_type": "electric",
    "bill_cycle": 202011,
    "growth": 6.943168459257968
  },
  {
    "total_usage": 177721.61,
    "total_cost": 28309.91,
    "service_type": "electric",
    "bill_cycle": 202012,
    "growth": 1.8942130158661756
  },
  {
    "total_usage": 178153.16,
    "total_cost": 28846.16,
    "service_type": "electric",
    "bill_cycle": 202101,
    "growth": -2.4447274784581348
  },
  {
    "total_usage": 167363.22,
    "total_cost": 28140.95,
    "service_type": "electric",
    "bill_cycle": 202102,
    "growth": -5.479594683193005
  },
  {
    "total_usage": 166643.24,
    "total_cost": 26598.94,
    "service_type": "electric",
    "bill_cycle": 202103,
    "growth": -1.7551075343603926
  },
  {
    "total_usage": 156703.06,
    "total_cost": 26132.1,
    "service_type": "electric",
    "bill_cycle": 202104,
    "growth": -6.105135063772135
  },
  {
    "total_usage": 167743.86,
    "total_cost": 24536.7,
    "service_type": "electric",
    "bill_cycle": 202105,
    "growth": 26.77911047532879
  },
  {
    "total_usage": 219591.42,
    "total_cost": 31107.41,
    "service_type": "electric",
    "bill_cycle": 202106,
    "growth": 12.341914675635174
  },
  {
    "total_usage": 238410.76,
    "total_cost": 34946.66,
    "service_type": "electric",
    "bill_cycle": 202107,
    "growth": -0.028586422851297484
  },
  {
    "total_usage": 213886.42,
    "total_cost": 34936.67,
    "service_type": "electric",
    "bill_cycle": 202108,
    "growth": -14.26755898601669
  },
  {
    "total_usage": 183369.9,
    "total_cost": 29952.06,
    "service_type": "electric",
    "bill_cycle": 202109,
    "growth": -8.27078337850552
  },
  {
    "total_usage": 173785.92,
    "total_cost": 27474.79,
    "service_type": "electric",
    "bill_cycle": 202110,
    "growth": -0.1291001678265827
  },
  {
    "total_usage": 165635.56,
    "total_cost": 27439.32,
    "service_type": "electric",
    "bill_cycle": 202111,
    "growth": 2.6127834071689833
  },
  {
    "total_usage": 192022.99,
    "total_cost": 28156.25,
    "service_type": "electric",
    "bill_cycle": 202112,
    "growth": 34.387640399556034
  },
  {
    "total_usage": 181989.47,
    "total_cost": 37838.52,
    "service_type": "electric",
    "bill_cycle": 202201,
    "growth": -6.705759104742979
  },
  {
    "total_usage": 163989.41,
    "total_cost": 35301.16,
    "service_type": "electric",
    "bill_cycle": 202202,
    "growth": -15.256127560680735
  },
  {
    "total_usage": 171858.18,
    "total_cost": 29915.57,
    "service_type": "electric",
    "bill_cycle": 202203,
    "growth": null
  }
]
// Helper function to get the Date in the format of MMYYYY
function renderDateFromString(datestring){
  const yearmonth = new String(datestring)
  return yearmonth.substring(0, 4) + "-" + yearmonth.substring(4) + 'T00:00:00'
}
// Helper function to search JSON in LinearTime.
function search_array(array,valuetofind) {
  for (i = 0; i < array.length; i++) {
      if (array[i].bill_cycle === valuetofind) {
          return array[i];
      }
  }
  return undefined;
}

const service = 'natural_gas';
// Variable to store the time Data for the specific service type
var arrService = newVar.map(function(item) {
  if (item.service_type === service) {
    item.bill_cycle = new Date(renderDateFromString(item.bill_cycle)).toLocaleDateString("en-US", { year: 'numeric', month: 'short'})
    return item
  }
}).filter(function(item){
  return item !== undefined
})




// This variable stores the data for the current data.
var current = arrService.map(function(item) {
  var newItem = new Date(item.bill_cycle);
  newItem.setFullYear(newItem.getFullYear() + 1)
  if (newItem <= new Date('2022-03-01T07:00:00.000Z')) {
    return search_array(arrService, newItem.toLocaleDateString("en-US", { year: 'numeric', month: 'short'}))
  }
}).filter(item => item !== undefined);

// This variable stores the data for the past data.

var previous = current.map(function(item) {
  var newItem = new Date(item.bill_cycle);
  newItem.setFullYear(newItem.getFullYear() - 1)
  newItem = newItem.toLocaleDateString("en-US", { year: 'numeric', month: 'short'})
  return search_array(arrService, newItem)
}).filter(item => item !== undefined);


var limitIndex = current.length - 1;
var limit = current[limitIndex].bill_cycle;

var predictionDates = current.map(function(item) {
  var newItem = new Date(item.bill_cycle);
  newItem.setFullYear(newItem.getFullYear() + 1)
  var threshold = new Date('2022-03-01T07:00:00.000Z') // YYYY-MM-DDTHH:MM:SS.SSSZ\
  if (newItem > threshold) {
    newItem = newItem.toLocaleDateString("en-US", { year: 'numeric', month: 'short'})
    return newItem
  }
}).filter(item => item !== undefined);



var predictionPrev = predictionDates.map(function(item) {
  var newItem = new Date(item);
  newItem.setFullYear(newItem.getFullYear() - 1)
  newItem = newItem.toLocaleDateString("en-US", { year: 'numeric', month: 'short'})
  return search_array(arrService, newItem)
}).filter(item => item !== undefined);

console.log(predictionPrev)
console.log('BOOYAH')


var calculated = predictionPrev.map(item =>{
  item.total_cost += item.total_cost*0.012 + item.total_cost*0.068
  return item
})
for (var i = 0; i < calculated.length; i++) {
  calculated[i].bill_cycle = predictionDates[i]
}

console.log(calculated)
